- The Diffie-Hellman Key Exchange is a mathematical method of securely creating a shared secret (most often a symmetric encryption key) between two clients over an insecure/public channel by using public and private variables.
- This method is widely used such as in [[SSH]], [[TLS]], [[SSL]] and most end-to-end encryption protocols
- Using this method it is essential for both parties to never share their secrets without mixing it to guarantee they are the only ones who are able to create the shared secret.
- # Description
- Given two parties, Alice and Bob, both of which have a secret component Alice -> a (orange), Bob -> b (cyan) and a common component c (yellow). For simplicity we use colours for this variables. Alice and Bob both create a mixture with their secret component and the public component and publish that mixture. Alice created the mixture `ac` and Bob created the mixture `bc`. They then exchange their mixture and add their secret to it to create the shared secret `abc`.
	- ![diffie-hellman-color-example.png](../assets/diffie-hellman-color-example_1689860915833_0.png){:height 450, :width 300}
- # Problems
- Diffie-Hellman does not include authentication and thus is vulnerable to man-in-the-middle attacks. The man-in-the-middle just needs to perform a diffie-hellman
- # FFDH - Finite Field Diffie-Hellman
  collapsed:: true
	- ## Mathematics
		- Components
			- `p` -> prime number (the modulus)
				- For best security this should be a large, safe prime number. To achieve the prime number to be safe it should conform:
					- should be an odd prime number
					- $p = 2q - 1$ where `q` is also prime (Sophie Germain)
			- `g` -> generator (the base)
				- For best security this should be a [[primitive root of  `n` modulo `n`]] of `p`
		- The key exchange will look something like this:
			- Party A will select a random number `a` (the exponent) between 1 and `p`, calculate the value of base g to the power a modulo p, let’s call it `x`, and send it to party B.
				- ## $x = g^{a} mod(p)$
			- Party B will do the same
				- ## $y = g^{b} mod(p)$
			- Upon receiving the value from B, party A will take that number `y` and raise it to power `a` modulo `p`. Similarly party B will take the number `x` and raise it to power `b` modulo `p`.
				- ## $y^{a} mod(p) = x^{b} mod(p)$
				- Since $x^b=g^{a^b}=g^{a·b}=g^{b·a}=g^{b^a}=y^a$ mod `p` both A and B get the same result without exchanging either `a` or `b` explicitly or a value that allows easy calculation of either `a` or `b`. This is because there is no efficient general algorithm to calculate [[discrete logarithms]]
		- Example with small numbers
			- Let  `p = 11`, `a = 2`, `b = 4`, `g = 7`
				- The [[Multiplicative group of integers modulo `n`]] of 11 is `[1, 2, 3, 4 ,5 ,6 ,7 ,8 ,9, 10]` of which `[2, 6, 7, 8]` are generators, hence the group is cyclic. `g` is randomly chosen from the set of generators.
			- Alice calculates:
				- ## $x = 7^{2} mod(11) = 5$
			- Bob calculates:
				- ## $y = 7^{4} mod(11) = 3$
			- `x = 5` and `y = 3` are shared publicly
			- Alice calculates their shared secret:
				- ## $s = y^{2} mod(11) =  9$
			- Bob calculates their shared secre:
				- ## $s = x^{4} mod(11) = 9$
- # ECDH - Elliptic Curve Diffie-Hellman
	- #WIP
- Source
	- https://www.redhat.com/en/blog/understanding-and-verifying-security-diffie-hellman-parameters
	- https://www.youtube.com/watch?v=ESPT_36pUFc
	- https://www.youtube.com/watch?v=NmM9HA2MQGI
	- https://www.youtube.com/watch?v=Yjrfm_oRO0w
	- https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange